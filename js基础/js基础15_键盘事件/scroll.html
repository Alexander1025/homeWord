<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			* {
				margin:0;
				padding:0;
			}
			#wrap {
				margin-top: 120px;
				position:relative;
				width:250px;
				height: 400px;
				background-color: greenyellow;
				overflow: hidden;
				-webkit-user-select: none;
			}
			#content {
				padding-right: 25px;
				position: relative;
			}
			#scrollBar {
				display: none;
				position: absolute;
				right:0;
				top:0;
				width:25px;
				height: 100%;
				background-color: #ccc;
			}
			#scrollBar div {
				position: absolute;
				width:100%;
				top:0;
				left:0;
				background-color: yellow;
			}
		</style>
	</head>
	<body>
		<div id="wrap">
			<div id="content">
			Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod
			tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
			quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
			consequat. Duis aute irure dolor in reprehenderit in voluptate
			tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam,
			quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
			consequat. Duis aute irure dolor in reprehenderit in voluptate
			 et dolore magna aliqua. Ut enim ad minim veniam,
			quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
			consequat. Duis aute irure dolor in reprehenderit in voluptate
			 et dolore magna aliqua. Ut enim ad minim veniam,
			quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
			consequat. Duis aute irure dolor in reprehenderit in voluptate
			 et dolore magna aliqua. Ut enim ad minim veniam,
			quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo
			consequat. Duis aute irure dolor in reprehenderit in voluptate
			</div>
			<div id="scrollBar"></div>
		</div>
		<script type="text/javascript">
		

		window.onload = function() {
			var wrap = document.getElementById("wrap");
			var content = document.getElementById("content");
			var scrollBar = document.getElementById("scrollBar");
			

			//如果内容的高度没有超过容器，则不需要滚动条
			if(content.offsetHeight < wrap.offsetHeight) return;//以下内容不执行
			
			//wrap.offsetHeight / content.offsetHeight = slider.offsetHeight / scrollBar.offsetHeight;
			var scale = wrap.offsetHeight / content.offsetHeight;
			scrollBar.style.display = "block";
			var slider = document.createElement("div");
			var sliderHeight = Math.round(scale * scrollBar.offsetHeight);
			slider.style.height = sliderHeight + "px";
			scrollBar.appendChild(slider);

			//添加点击事件
			scrollBar.onclick = function(e) {
				var e = e || window.event;
				// var target = e.target || e.srcElement;
				// if(target.id == "scrollBar") {
				// 	slider.style.top = e.clientY - slider.offsetHeight/2 + "px";
				// }
				var wrapPostition = wrap.getBoundingClientRect();
				var goTop = e.clientY - slider.offsetHeight/2 - wrapPostition.top;
				//判断边界
				if(goTop < 0) {
					goTop = 0;
				}else if(goTop > (scrollBar.offsetHeight - sliderHeight)) {
					goTop = scrollBar.offsetHeight - sliderHeight;
				}
				var sX = goTop / scrollBar.offsetHeight;

				slider.style.top = goTop + "px";
				content.style.top = - sX*content.offsetHeight + "px";
			}
			//阻止点击事件冒泡
			slider.onclick = function(e) {
				var e = e || window.event;
 				e.cancelBubble = true;
			}

			//添加滚轮事件
			mousewheel(wrap, function(e) {
				var goTop = slider.offsetTop;
				if(e.delta) {
					// alert('down')
					goTop += 10;
				}else {
					goTop -= 10;
				}
				//判断边界
				if(goTop < 0) {
					goTop = 0;
				}else if(goTop > (scrollBar.offsetHeight - sliderHeight)) {
					goTop = scrollBar.offsetHeight - sliderHeight;
				}
				var sX = goTop / scrollBar.offsetHeight;
				slider.style.top = goTop + "px";
				content.style.top = - sX*content.offsetHeight + "px";
			});
		function mousewheel(element, callback) {
			element.onmousewheel = fn;
			if(element.addEventListener) {
				element.addEventListener("DOMMouseScroll", fn, false);
			}
			
			function fn(e) {
				if(e.wheelDelta < 0 || e.detail > 0) {
					e.delta = true;
				}else {
					e.delta = false;
				}
				callback(e);
				//以下阻止默认事件
				if(e.preventDefault) {
					e.preventDefault();
				}
				return false;
			}
		}

			//添加键盘事件
			document.onkeydown = function(e) {
				var e = e || window.event;
				var goTop = slider.offsetTop;
				// console.log(e)
				if(e.keyCode == 38) {
					goTop -= 10;
				}else if(e.keyCode == 40) {
					goTop += 10;
				}
				// console.log(goTop);
				//判断边界
				if(goTop < 0) {
					goTop = 0;
				}else if(goTop > (scrollBar.offsetHeight - sliderHeight)) {
					goTop = scrollBar.offsetHeight - sliderHeight;
				}
				var sX = goTop / scrollBar.offsetHeight;
				slider.style.top = goTop + "px";
				content.style.top = - sX*content.offsetHeight + "px";
				return false;
			}

			//添加拖拽
			slider.onmousedown = function(e) {
				var e = e || window.event;
				var oH = e.clientY - slider.offsetTop;
				document.onmousemove = function(e) {
					var e = e || window.event;
					var goTop = e.clientY - oH;

					//判断边界
					if(goTop < 0) {
						goTop = 0;
					}else if(goTop > (scrollBar.offsetHeight - sliderHeight)) {
						goTop = scrollBar.offsetHeight - sliderHeight;
					}
				
					slider.style.top = goTop + "px";

					var sX = goTop / scrollBar.offsetHeight;
					content.style.top = - sX*content.offsetHeight + "px";
				}
				document.onmouseup = function() {
					document.onmousemove = null;
				}
			}

		} 
		</script>
	</body>
</html>













